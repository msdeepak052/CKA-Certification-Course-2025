
## Task

This task must be completed on **node01**. Use the following credentials to access the node via SSH:

* **Username:** `bob`
* **Password:** `caleston123`

### Objective

Prepare **node01** for a Kubernetes installation by setting up a container runtime.

1. Install the `cri-docker_0.3.16.3-0.debian.deb` package located in `/root`.
2. Ensure the `cri-docker` service is **running** and **enabled** to start on boot.

---

## Solution

### 1. Access the Node

SSH into **node01** using the provided password:

```bash
ssh bob@node01

```

### 2. Elevate Privileges

Switch to the root user to execute administrative commands:

```bash
sudo -i

```

### 3. Install the Package

Use `dpkg` to install the `.deb` package located in the `/root` directory:

```bash
dpkg -i /root/cri-docker_0.3.16.3-0.debian.deb

```

### 4. Manage the Service

Start the `cri-docker` service and configure it to launch automatically at boot:

```bash
systemctl start cri-docker
systemctl enable cri-docker

```

### 5. Verification

Confirm the service is active and properly enabled:

| Command | Expected Output |
| --- | --- |
| `systemctl is-active cri-docker` | `active` |
| `systemctl is-enabled cri-docker` | `enabled` |

---

Here is the formatted Markdown for the troubleshooting task.

---

## Task

A new application, **orange**, has been deployed, but it is failing to start correctly. Identify the root cause and resolve the issue.

---

## Solution

### 1. Identify the Issue

Inspect the details of the **orange** pod to find the error:

```bash
kubectl describe po orange

```

Check the `initContainers` section. You will notice a syntax error in the command:

> **Command:**
> `sh -c sleeeep 2;`

The command `sleeeep` is misspelled and is causing the container to fail during initialization.

### 2. Update the Pod

Since you cannot edit most fields of a running pod directly (including the command of an initContainer), use the `edit` command:

```bash
kubectl edit po orange

```

1. Locate the `initContainers` section in the YAML manifest.
2. Correct `sleeeep 2;` to `sleep 2;`.
3. Save and exit the editor.

### 3. Apply the Changes

Because Kubernetes does not allow live updates to this specific field, saving the file will generate a temporary manifest in your `/tmp/` directory. Use that file to replace the existing pod:

```bash
kubectl replace -f /tmp/kubectl-edit-xxxx.yaml --force

```

*(Note: Replace `xxxx` with the actual random string generated by the edit command.)*

**The `--force` flag ensures the old pod is deleted and recreated immediately with the corrected configuration.**

---

### 4. Verification

Check the status to ensure the pod is now running:

```bash
kubectl get po orange

```

---


## Task 11: Deploy a Vertical Pod Autoscaler (VPA)

### Objective

Deploy a VPA named `analytics-vpa` for the `analytics-deployment` in the `default` namespace. The VPA must optimize CPU and memory requests using the **Recreate** update mode.

### Solution

Execute the following command to create the VPA resource using a "here document" (EOF):

```yaml
kubectl create -n default -f - <<EOF
apiVersion: autoscaling.k8s.io/v1
kind: VerticalPodAutoscaler
metadata:
  name: analytics-vpa
  namespace: default
spec:
  targetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: analytics-deployment
  updatePolicy:
    updateMode: "Recreate"
EOF

```

---

## Task 12: Create a Kubernetes Gateway Resource

### Objective

Create a Gateway resource with the following specifications:

* **Name:** `web-gateway`
* **Namespace:** `nginx-gateway`
* **Gateway Class:** `nginx`
* **Listener:** Port `80`, Protocol `HTTP`, Name `http`

### Solution

Run the following command to deploy the Gateway:

```yaml
kubectl create -n nginx-gateway -f - <<EOF
apiVersion: gateway.networking.k8s.io/v1
kind: Gateway
metadata:
  name: web-gateway
  namespace: nginx-gateway
spec:
  gatewayClassName: nginx
  listeners:
    - name: http
      protocol: HTTP
      port: 80
EOF

```

---

## Task 13: Update and Upgrade a Helm Release

### Objective

Update the Helm repository and upgrade the existing `kk-mock1` release in the `kk-ns` namespace to version `18.1.15`.

### Solution

#### 1. Locate the Release

List all Helm releases across all namespaces to confirm the deployment:

```bash
helm ls -A

```

#### 2. Update the Repository

Update your local Helm chart cache to fetch the latest available versions:

```bash
helm repo update

```

#### 3. Verify Available Versions

Search for the specific chart version to ensure `18.1.15` is available:

```bash
helm search repo kk-mock1/nginx -n kk-ns -l | head -n 30

```

#### 4. Upgrade the Release

Perform the upgrade to the target version. If you need to scale the application simultaneously, you can append the replica flag:

```bash
helm upgrade kk-mock1 kk-mock1/nginx -n kk-ns --version 18.1.15

```

#### 5. Verify the Upgrade

Check the status and version of the release:

```bash
helm ls -n kk-ns

```

> **Note:** Verify the version number under the **CHART** column in the output.

---

